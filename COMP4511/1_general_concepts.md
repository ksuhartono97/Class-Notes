# Overview of General OS concepts

Useful references:
- [Bootlin](https://elixir.bootlin.com/linux/latest/source)

Device drivers: specialized software that knows how to access hardware that is plugged to your computer. Not part of the OS, just helps you to communicate with a specialized device.

Philosophies in building OS kernels:
- Monolithic kernel: the kernel is going to be one big kernel program. Shared memory within the program, that is every instruction in the program knows all the other instructions that are happening in the kernel. Problem is kernel footprint can get very large.
- Micro kernel: Only puts the basic activities in the kernel, everything else is run in user mode. There are inter process communication here. Much slower, need to communicate messages between processes to inform other services.


```
If any process crashes, the system doesn't crash in the micro kernel. However, in the monolithic kernel, it can crash the whole system.
```

## Linux
Applications communicate with kernel using system calls. Many functions in standard C library doesn't actually need to call a system call in order to execute the job. This is because system calls are really expensive. So it is often not recommended to create your own system call as it is often useless.

Standardized system call library: POSIX (portable operating system interface), defines 300 system calls that can do anything possible in interacting with the OS.

Block devices: accesses the data in blocks, can have random access

Character devices: accesses the data in a sequential manner.

All processes descend hierarchically from the init process. The init process is the first process that is started at boot. Addresses in a process are all part of the virtual address space.

When executing a command in a shell, the shell will clone itself and it will run the command in the clone to see what the command actually does.

Address space:
- Physical: determined by hardware
- Virtual: generated by CPU. Virtual memory will take care of translating virtaull addresses to physical addresses.

Space divisions:
- Kernel space is continuous and shared, it is always running since the boot of the system. Keeps the same address always.
- User space is exclusive to a certain process. Generated for each process.

Protection rings to protect the stability of the OS. These are privilege modes:
- Kernel mode: a privileged mode, you can do whatever you want in this mode. The kernel is usually protected, can't just do anything.
- User mode: restrictions are in place, i.e. cannot execute, cannot access certain areas, cannot access other user data.

In virtualized environments, there will be more protection levels, such as the hypervisor level.

Switching between modes:
- System calls: make a system call that allows us to jump to kernel mode (change state) and go into a process context. Process context means that we are executing a piece of code in the kernel on behalf of a process. Copies resources from user space to kernel space. During this, the process sleeps until the syscall is completed.
- Interrupts: when a hardware device needs attention from the kernel it generates an electrical signal to the CPU. The CPU will then interrupt the kernel. The interrupt then needs to be processed. Processing is called interrupt handling, done by the interrupt handler that needs to be executed every time there is an interrupt. Interrupt service routine is a function that is used to specifically run interrupt handlers. Cannot recover from sleep status, there is no notion of original process here.

Memory management:
- Physical memory and virtual memory is divided into pages. In physical memory its called page frames.
- Need to keep a mapping between virtual and physical pages. This is called the page table.
- Demand paging: pages are brought in when needed. Memory management unit will call a pagefault, load the page to memory, and reexecute the instruction.
- TLB (translation look-aside buffer): keeps track of recent translations in faster memory so we don't have to translate addresses repeatedly.
